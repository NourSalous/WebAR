<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>3D Heart Model Smooth Hotspots</title>
<script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>
<style>
* { box-sizing: border-box; }

body {
  margin: 0;
  padding: 0;
  background: #fff;
  height: 100vh;
  overflow: hidden;
  font-family: "DM Sans", sans-serif;
}

model-viewer {
  width: 100vw;
  height: 100vh;
  background-color: #fff;
  cursor: grab;
  --poster-color: transparent;
}

.hotspot {
  background: #67130c;
  border-radius: 50%;
  width: 33px;
  height: 33px;
  border: 2px solid #fff;
  cursor: pointer;
  position: relative;
  box-shadow: 0 0 6px rgba(103,19,12,0.4);
  display: flex;
  align-items: center;
  justify-content: center;
}

.label {
  display: none;
  position: absolute;
  top: 50%;
  left: 40px;
  transform: translateY(-50%);
  padding: 8px 14px;
  border-radius: 6px;
  background: #fff;
  border: 1px solid #e0e0e0;
  color: #67130c;
  font-size: 15px;
  font-weight: 600;
  white-space: nowrap;
  opacity: 0;
  transition: opacity 0.3s ease;
  box-shadow: 0 2px 6px rgba(0,0,0,0.1);
}

.label::before {
  content: "";
  position: absolute;
  top: 50%;
  left: -20px;
  transform: translateY(-50%);
  width: 20px;
  height: 1.5px;
  background: #67130c;
}

.hotspot.active .label {
  display: block;
  opacity: 1;
}
</style>
</head>
<body>

<model-viewer 
  id="heartViewer"
  src="realistic_human_heart.glb"
  camera-controls
  interaction-prompt="none"
  shadow-intensity="1"
  camera-orbit="0deg 75deg 3.5m"
  min-camera-orbit="auto 15deg 1m"
  max-camera-orbit="auto 90deg 18m"
  field-of-view="45deg"
  camera-target="0m 0m 0m"
  ar
></model-viewer>

<!-- Hotspots -->
<button id="hotspot-svc" class="hotspot" slot="hotspot-svc"
  data-position="-0.340815m 0.711882m 0.172959m"
  data-normal="0m 1m 0m">
  <span class="label">Superior Vena Cava</span>
</button>

<button id="hotspot-pa" class="hotspot" slot="hotspot-pa"
  data-position="0.419654m 0.412853m 0.077488m"
  data-normal="0m 1m 0m">
  <span class="label">Pulmonary Arteries</span>
</button>

<button id="hotspot-aorta" class="hotspot" slot="hotspot-aorta"
  data-position="0.101478m 0.622114m -0.123833m"
  data-normal="0m 1m 0m">
  <span class="label">Aorta</span>
</button>

<script>
const viewer = document.querySelector("#heartViewer");
const hotspots = document.querySelectorAll(".hotspot");

// ===== HELPER: Convert deg/m to numbers for interpolation =====
function parseOrbit(orbitStr) {
  const parts = orbitStr.split(' ');
  return {
    theta: parseFloat(parts[0]),
    phi: parseFloat(parts[1]),
    radius: parseFloat(parts[2])
  };
}

function orbitToString(orbit) {
  return `${orbit.theta}deg ${orbit.phi}deg ${orbit.radius}m`;
}

// ===== SMOOTH CAMERA ANIMATION =====
function animateCamera(targetOrbitStr, duration = 1000) {
  const startOrbit = parseOrbit(viewer.cameraOrbit);
  const endOrbit = parseOrbit(targetOrbitStr);
  const startTime = performance.now();

  function animate(time) {
    const t = Math.min((time - startTime)/duration, 1); // 0 â†’ 1
    const ease = t < 0.5 ? 2*t*t : -1+(4-2*t)*t; // smooth ease in/out

    const currentOrbit = {
      theta: startOrbit.theta + (endOrbit.theta - startOrbit.theta) * ease,
      phi: startOrbit.phi + (endOrbit.phi - startOrbit.phi) * ease,
      radius: startOrbit.radius + (endOrbit.radius - startOrbit.radius) * ease
    };

    viewer.cameraOrbit = orbitToString(currentOrbit);

    if (t < 1) requestAnimationFrame(animate);
  }

  requestAnimationFrame(animate);
}

// ===== FOCUS FUNCTION =====
function focusOnPart(hotspotId, orbitStr, target) {
  hotspots.forEach(h => h.classList.remove("active"));
  document.getElementById(hotspotId).classList.add("active");
  viewer.cameraTarget = target; // set target immediately
  animateCamera(orbitStr, 1200); // smooth orbit over 1.2s
}

// ===== HOTSPOT CLICK EVENTS =====
document.querySelector("#hotspot-svc").addEventListener("click", () => {
  focusOnPart("hotspot-svc", "-40deg 65deg 1.2m", "-0.340815m 0.711882m 0.172959m");
});

document.querySelector("#hotspot-pa").addEventListener("click", () => {
  focusOnPart("hotspot-pa", "100deg 85deg 2.0m", "0.05m 0.1m 0.03m");
});

document.querySelector("#hotspot-aorta").addEventListener("click", () => {
  focusOnPart("hotspot-aorta", "-10deg 40deg 1.5m", "0.01m 0.60m 0.03m");
});
</script>

</body>
</html>
